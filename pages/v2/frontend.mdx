# Website

## Overview

- Deployed on AWS using the [CloudFront CDN](https://aws.amazon.com/cloudfront/) and [Lambda@Edge](https://aws.amazon.com/lambda/edge/).
- Configured to use a [TypeScript monorepo](https://maxrohde.com/2021/11/20/the-ultimate-guide-to-typescript-monorepos/) to easily combine front-end and back-end code in one repository.
- Scalable AWS infrastructure defined in Terraform
- Served through CloudFront CDN and stored in S3 at very low costs.
- Next.js Framework

### Key Config:

- **Hosted Zone Domain**: `glyphx.co`
- **Primary Website Domain**: `https://glyphx.co`.
- **Redirect Website Domain**: `https://www.glyphx.co`.
- **Default Cache Duration**: `120` seconds

## Useful Commands

Stand up infra

```bash
yarn infra up [deploymentName]

```

This will be either `yarn infra up dev` or `yarn infra up prod` depending on your choice of deployment. Note that running this command can take a while.

Deploy:

```bash
yarn deploy [deploymentName]

```

This will either be `yarn deploy dev` or `yarn deploy prod` depending on your choice of deployment during project configuration.

Terraform files live at `[moduleDir]/infra/aws`. There are multiple deployments for dev, staging and prod.

Infrastructure commands for this template can be run using `yarn`. There are four commands in total:

- `yarn infra up`: For standing up infrastructure.
- `yarn infra init`: For [initialising Terraform](https://www.terraform.io/docs/commands/init.html).
- `yarn infra plan`: For running [Terraform plan](https://www.terraform.io/docs/commands/plan.html).
- `yarn infra apply`: For running [Terraform apply](https://www.terraform.io/docs/commands/apply.html).
- `yarn infra destroy`: For destroying all infrastructure using [Terraform destroy](https://www.terraform.io/docs/commands/destroy.html).
- `yarn infra upgrade`: For upgrading the Terraform versions (supported by the template). To upgrade to an arbitrary version, use `yarn infra terraform`.
- `yarn infra terraform`: For running arbitrary [Terraform commands](https://www.terraform.io/cli/commands).

For each command, the deployment env must be specified.

```
yarn infra [command] [deploymentName]

```

For instance, to stand up the infrastructure for the `dev` deployment:

```
yarn infra up dev

```

Note that for running `yarn infra terraform`, you will need to specify which command line arguments you want to provide to Terraform. By default, no extra arguments are provided:

```
yarn infra terraform [deployment] plan

```

If extra arguments are needed, such as variables, you can use the `--inject-variables` option, such as for running `terraform plan`:

```
yarn infra terraform [deployment] --inject-variables plan

```

If you want to interact with the remote backend, you can also provide the `--inject-backend-config` option, such as for running `terraform init`:

```
yarn infra terraform [deployment] --inject-backend-config init

```

Terraform maintains a state for each deployment; to calculate required changes when the infrastructure is updated and also for destroying the infrastructure if it is no longer required. Terraform state is stored in the `infra/aws` folder as simple files.

Note that deployment will only work _after_ the infrastructure for the respective deployment has been stood up. To deploy your package, run the following script:

```
yarn deploy [deploymentName]

```
